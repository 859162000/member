(function(b){var d={getContextPath:function(){var a=document.location.pathname,b=a.substr(1).indexOf("/");return a.substr(0,b+1)},render:function(a,e){var f=b.wrender[a];if(null==f)return alert(c.failType+a+'"!'),b(e);if(!0!=e[c.rendered])return e[c.rendered]=!0,f.render.apply(f,[e])},validate:function(a,e){return null==b.wrender[a]?(alert(c.failType+a+'"!'),!1):!0},show:function(a,e){var f=b.wrender[a];null==f?alert(c.failType+a+'"!'):void 0!=f.show&&"function"==typeof f.show?f.show.apply(f,[e]):
b(e).show()},hide:function(a,e){var f=b.wrender[a];null==f?alert(c.failType+a+'"!'):void 0!=f.hide&&"function"==typeof f.hide?f.hide.apply(f,[e]):b(e).hide()}},c={type:"wrType",param:"wrParam",name:"name",value:"wrValue",rendered:"wrRendered",failType:'Failed to recognized the wrType:"',failAction:"Plugin wrender failed to found the action:"};b.wrender=b.wrender||{};void 0==b.wrender.context&&(b.wrender.context=d.getContextPath());b.extend(b.wrender,{filterOutNull:function(a){return null==a?"":a},
getValueProp:function(a){return a[c.value]},setValueProp:function(a,b){a[c.value]=b},getValue:function(a){var e=b(a).attr(c.type);d.validate(e,a)?(e=b.wrender[e],e=e.getValue.apply(e,[a]),null==e&&(e=""),a[c.value]=e):e=null;return e},setValue:function(a,e){var f=b(a),l=f.attr(c.type);void 0!==e&&d.validate(l,a)&&(a[c.value]=e,l=b.wrender[l],l.setValue.apply(l,[a,e]),f=f.prev("span[name=readlabel]"),0<f.size()&&f.html(l.getValueLabel.apply(l,[a,e])))},wrapChange:function(a,e){return function(a){0==
e.length?e.call(this):1==e.length?(a=b.wrender.getValue(this),e.apply(this,[a])):alert("wrender event function change() only support 0 or 1 arguments!")}},getParam:function(a){a=b(a).attr(c.param);if(null!=a&&(a=a.split(";"),null!=a&&0<a.length)){var e={};b.each(a,function(){var a=this.split(":");if(null!=a&&2<=a.length){var b=a[0].replace(/(^\s*)|(\s*$)/g,""),a=a[1].replace(/(^\s*)|(\s*$)/g,"");e[b]=a}});return e}return null},getHtml:function(a,e,f){var c=b.wrender[e];if(null!=c&&null!=c.getHtml)return c.getHtml(a,
f);alert("Can't support wrender getHtml method for type:"+e+" !");return null},getOperatorHtml:function(a,c){html='<select wrType="select" operator="true" name="'+a+'">';b.each(c,function(a,c){var e=c.replace(/(^\s*)|(\s*$)/g,""),d=b.wrender.operatorLabelMap[e];null!=d?html+='<option value="'+e+'">'+d+"</option>":alert('Operator "'+e+'" not exists! Please check configuration!')});return html+="</select>"},operatorLabelMap:{eq:"=",ne:"!=",gt:"&gt;",lt:"&lt;",ge:"&gt;=",le:"&lt;=",like:"\u5339\u914d",
between:"\u533a\u95f4",nbetween:"\u533a\u95f4\u5916","in":"\u5305\u542b",nin:"\u4e0d\u5305\u542b"}});b.fn.wrender=function(a,e,f){a=a||"render";switch(a){case "render":return this.each(function(){var a=b(this).attr(c.type);d.render(a,this)});case "setValue":return this.each(function(a,f){var d=b(f).attr(c.name);b.wrender.setValue(f,e[d])});case "getValue":var l={};this.each(function(a,f){var e=b(f).attr(c.name),d=b.wrender.getValue(f);null!=d&&(l[e]=d)});return l;case "getValueData":var k={};this.each(function(a,
f){var e=b(f).attr(c.name),d=b.wrender.getValue(f);k[e]=d});return encodeURI(JSON.stringify(k));case "getValueLabel":var h={};this.each(function(a,f){var e=b(f),l=e.attr(c.type),e=e.attr(c.name);d.validate(l,f)?(l=b.wrender[l],h[e]=l.getValueLabel.apply(l,[f,f[c.value]])):h[e]=null});return h;case "toReadOnly":return this.each(function(a,l){var k=b(l),h=k.attr(c.type),p=k.attr(c.name);if(!k.is("input[type=hidden]")||"text"!=h&&"readtext"!=h)if(null!=e&&b.wrender.setValue(l,e[p]),!0===f){var p=b.wrender[h],
p=p.getValueLabel.apply(p,[l,l[c.value]]),r=k.prev("span[name=readlabel]");0<r.size()?(r.show(),r.html(p)):k.before('<span name="readlabel">'+p+"</span>");d.hide(h,l)}else k.prev("span[name=readlabel]").hide(),d.show(h,l)});case "change":return null==e||"function"!=typeof e?(alert('Error wrender "change" defintion! The second parameter must be a function!'),this):this.each(function(a,f){var l=b(f).attr(c.type);if(d.validate(l,f)){var k=b.wrender[l];void 0!=k.change&&"function"==typeof k.change?k.change.apply(k,
[f,e]):alert("The wrender plugin type="+l+" not support the change(elem, onChangeFunctoin) method!")}});default:return alert(c.failAction+a),this}}})(jQuery);(function(b){b.extend(b.wrender,{text:{render:function(b){},setValue:function(d,c){b(d).val(b.wrender.filterOutNull(c))},getValue:function(d){return b(d).val()},getValueLabel:function(b){return this.getValue(b)},change:function(d,c){b(d).change(b.wrender.wrapChange(d,c))},getHtml:function(b,c){return html='<input type="text" wrType="text" '+(null!=c?'wrParam="'+c+'"':"")+'name="'+b+'"></input>'}},textarea:{render:function(b){},setValue:function(d,c){b(d).attr("value",b.wrender.filterOutNull(c))},
getValue:function(d){return b(d).attr("value")},getValueLabel:function(b){return this.getValue(b)},change:function(d,c){b(d).change(b.wrender.wrapChange(d,c))},getHtml:function(b,c){return html='<textarea wrType="textarea" '+(null!=c?'wrParam="'+c+'"':"")+'name="'+b+'" rows="3" cols="50"></textarea>'}},readtext:{render:function(b){},setValue:function(d,c){b(d).text(b.wrender.filterOutNull(c))},getValue:function(d){return b(d).text()},getValueLabel:function(b){return this.getValue(b)},change:function(d,
c){b(d).change(b.wrender.wrapChange(d,c))},getHtml:function(b,c){return html='<div wrType="readtext" '+(null!=c?'wrParam="'+c+'"':"")+'name="'+b+'"></div>'}},button:{render:function(d){var c=b(d);d=b.wrender.getParam(d);var a={};null!=d&&(void 0!=d.icon?a.icons={primary:d.icon}:(void 0!=d.icons-primary&&(a.icons={primary:d.icon}),void 0!=d.icons-secondary&&(a.icons=a.icons||{},a.icons.secondary=d.icon)),void 0!=d.text&&(a.text="true"==d.text||"yes"==d.text?!0:!1),void 0!=d.label&&(a.label=d.label),
void 0!=d.disabled&&(a.disabled="true"==d.disabled||"yes"==d.disabled?!0:!1));c.button(a)},getHtml:function(b,c){return html='<button type="button" wrType="button" '+(null!=c?'wrParam="'+c+'"':"")+'name="'+b+'"/>'}}})})(jQuery);(function(b){var d={defCache:{},popDialogCache:{},getInnerHtml:function(a){return'<span name="valueLabel"></span><button name="popup" type="button" class="wr_button">'+a+"</button>"},getPopDialogHtml:function(a,b,f,c){return'<div id="composite_'+a+'"><table width="100%" align="center" class="ui-widget ui-widget-content"><tr><td><form id="composite_form_'+a+'"><table name="criteria" width="100%"></table></form></td><td width="100"  valign="top" align="center"><button name="onSearch" class="wr_button" type="button">\u641c\u7d22</button><br/><label '+
(f?'style="display:none;"':"")+'><input type="checkbox" name="selTarget" '+(b?'checked="checked"':"")+"/>"+c+'</label></td></tr></table><br/><div style="width:100%"><table id="composite_list_'+a+'"></table><div id="composite_pager_'+a+'" style="text-align:center;"></div></div></div>'},toLabelString:function(a){var e="";if(null!=a)if(a.selTarget){var f=a.selections.value.length;f!=a.selections.valueLabel.length&&alert("Error convert the value to label from composite! (selections.valueLabel.length != selections.value.length)");
if(0<f)for(var e=e+'<span style="font-weight:bold;">\u5df2\u9009:</span>',c=0;c<f;c++)var d=a.selections.valueLabel[c],e=0!=c?e+("; "+d):e+d}else{for(var d=a.criteria.length,h=!0,c=0;c<d;c++){var g=a.criteria[c],m=!1;if(g.value instanceof Array)for(var n=0,f=g.value.length;n<f;n++)if(null==g.value[n]||""===g.value[n]){m=!0;break}if(null!=g.value&&""!==g.value&&!m){f=b.wrender.operatorLabelMap[g.operator];m="";if("between"!==f||null==g.valueLabel[0]&&null==g.valueLabel[1])if(g.valueLabel instanceof
Array)for(var q=g.valueLabel.length,p=!0,n=0;n<q;n++){var r=g.valueLabel[n];null!=r&&(m=p?m+r:m+("; "+r),p=!1)}else m=g.valueLabel;else m=g.valueLabel[0]+"~"+g.valueLabel[1];0<m.length&&(!1==h&&(e+="; "),e+='<span style="font-weight:bold;">'+g.label+"</span>"+f+"["+m+"]",h=!1)}}0<e.length&&(e='<span style="font-weight:bold;">\u6761\u4ef6:</span>'+e)}return e},retrieveCriteria:function(a){var c=[],f;for(f in a.inputs){var d=a.inputs[f],k="queryParam."+d.id,h=b("#composite_form_"+a.id+" table[name=criteria]"),
g=h.find('[name="'+k+'"]'),m=h.find('[name="'+k+'Alt"]'),h=h.find('select[name="'+k+'Operator"]').wrender("getValue")[k+"Operator"],n;if("between"===h){n=g.wrender("getValue")[k];var q=m.wrender("getValue")[k+"Alt"];n=[n,q];g=g.wrender("getValueLabel")[k];k=m.wrender("getValueLabel")[k+"Alt"];k=[g,k]}else n=g.wrender("getValue")[k],k=g.wrender("getValueLabel")[k];c.push({inputId:d.id,label:d.label,operator:h,value:n,valueLabel:k})}return c}},c=function(a){var c=d.popDialogCache[a.id];null==c&&(c=
{def:null,defaultDef:{id:null,title:"Query Target",selTarget:!0,hideSwitchLabel:!1,switchLabel:"\u6307\u5b9a\u76ee\u6807",popupLabel:"\u9009\u62e9\u76ee\u6807",queryUrl:null,selValue:null,selLabel:null,sortName:null,sortOrder:"asc",maxSelections:200,width:700,height:500,inputs:[],columns:[]},dialog:null,grid:null,elem:null,init:function(a){var c=this.def=b.extend({},this.defaultDef,a);a="#composite_"+c.id;var e=this;if(0==b(a).size()){b("body").append(d.getPopDialogHtml(c.id,c.selTarget,c.hideSwitchLabel,
c.switchLabel));b(a).dialog({title:c.title,bgiframe:!0,autoOpen:!1,width:c.width,height:c.height,resizable:!1,modal:!0,buttons:{"\u9009\u5b9a":function(){e._applyValue.apply(e)&&b(this).dialog("close")},"\u53d6\u6d88":function(){b(this).dialog("close")}},close:function(){}});this.dialog=b(a);for(var h in c.inputs)this._addCriterion(c.inputs[h]);var g=b("#composite_list_"+c.id);h=b("#composite_pager_"+c.id);var m=c.width-26;g.data("selections",{});g.jqGrid({datatype:"local",ajaxGridOptions:{type:"POST"},
jsonReader:{repeatitems:!1},prmNames:{page:"queryParam.page",rows:"queryParam.rows",sort:"queryParam.sort",order:"queryParam.order"},height:"100%",width:m,rowNum:10,viewrecords:!0,multiselect:!0,pager:h,url:c.queryUrl,colModel:c.columns,sortname:c.sortName,sortorder:c.sortOrder,onSelectRow:function(a,f,e){e=b(this).data("selections");var d=b(this).getRowData(a);a=d[c.selValue];d=d[c.selLabel];f?e[a]=d:delete e[a]},onSelectAll:function(a,e){var f=b(this).data("selections"),d;for(d in a){var k=a[d],
h=b(this).getRowData(k),k=h[c.selValue],h=h[c.selLabel];e?f[k]=h:delete f[k]}},gridComplete:function(){for(var a=b(this),f=a.data("selections"),e=a.getDataIDs(),d=0;d<e.length;d++){var k=e[d],h=a.getRowData(k)[c.selValue];null!=h&&(""!=h&&f[h])&&a.setSelection(k,!1)}}});b(a+" button.wr_button").button();b(a+" button[name=onSearch]").click(function(){e._search(c,g)});this.selTargetChange(g,c.selTarget);b(a+" input[name=selTarget]").change(function(){e.selTargetChange(g,this.checked)})}this.grid=b("#composite_list_"+
c.id);this.dialog=b(a)},selTargetChange:function(a,b){var c=a.getGridParam("width");b?a.jqGrid("showCol","cb"):a.jqGrid("hideCol","cb");c!=a.getGridParam("width")&&a.jqGrid("setGridWidth",c)},open:function(a,c){this.grid.clearGridData();this.grid.data("selections",{});this.elem=c;if(null!=a){for(var e=a.criteria.length,d=0;d<e;d++){var g=a.criteria[d],m="queryParam."+g.inputId,n=b("#composite_form_"+this.def.id+" table[name=criteria]"),q=n.find('[name="'+m+'"]'),p=n.find('[name="'+m+'Alt"]'),n=n.find('select[name="'+
m+'Operator"]'),r=q.parent().parent();if("between"===g.operator){if(null!=g.value){g.value instanceof Array&&2==g.value.length||alert("Error composite criterion value format! compositeId="+this.def.id+", inputId="+g.inputId);var s={};s[m]=g.value[0];q.wrender("setValue",s);q={};q[m+"Alt"]=g.value[1];p.wrender("setValue",q)}r.find("span[name=inputWidgetAltSpace]").show()}else null!=g.value&&(p={},p[m]=g.value,q.wrender("setValue",p)),r.find("span[name=inputWidgetAltSpace]").hide();q={};q[m+"Operator"]=
g.operator;n.wrender("setValue",q)}if(a.selTarget){e={};for(d in a.selections.value)p=a.selections.value[d],e[p]=a.selections.valueLabel[d];this.grid.data("selections",e)}b("input[name=selTarget]",this.dialog).attr("checked",a.selTarget);this.selTargetChange(this.grid,a.selTarget)}this._search(this.def,this.grid);return this.dialog.dialog("open")},_applyValue:function(){var a={selTarget:this.dialog.find("input[name=selTarget]")[0].checked,criteria:null,selections:{value:[],valueLabel:[]}};a.criteria=
d.retrieveCriteria(this.def);if(!0==a.selTarget){var c=this.grid.data("selections");if(null!=c){var e=0,h;for(h in c){var g=c[h];a.selections.value.push(h);a.selections.valueLabel.push(g);e++}if(e>this.def.maxSelections)return b.msgBox("warn","\u9009\u62e9\u9519\u8bef","\u5217\u8868\u4e2d\u7684\u9009\u62e9\u9879\u8fc7\u591a\uff01\u76ee\u524d\u9009\u62e9\u4e86"+e+"\u9879\u6570\u636e\uff0c\u800c\u6700\u5927\u9650\u5236\u662f"+this.def.maxSelections),!1}}else this.grid.data("selections",{});b.wrender.setValueProp(this.elem,
a);b("span[name=valueLabel]",this.elem).html(d.toLabelString(a));if(void 0!=this.elem.wrChange)for(c=this.elem,e=c.wrChange.length,h=0;h<e;h++)g=c.wrChange[h],0==g.length?g.apply(c):g.apply(c,[a]);return!0},_addCriterion:function(a){var c=a.allowedOperators.split(","),e=0<=b.inArray("between",c),d="queryParam."+a.id,g=b.wrender.getOperatorHtml(d+"Operator",c),e=e?b.wrender.getHtml(d,a.type,a.param)+'<span name="inputWidgetAltSpace" style="display:none;"> ~  '+b.wrender.getHtml(d+"Alt",a.type,a.param)+
"</span>":b.wrender.getHtml(d,a.type,a.param),g='<tr><td align="right"  width="100">'+a.label+'</td><td width="100">'+g+"</td><td>"+e+"</td></tr>";a=b("#composite_form_"+this.def.id+" table[name=criteria]");a.append(g);g=a.find('[name="'+d+'"]').wrender();a.find('[name="'+d+'Alt"]').wrender();var d=g.parent().parent(),m=d.find("span[name=inputWidgetAltSpace]");"between"===c[0]&&m.show();d.on("change",'select[operator="true"]',function(a){"between"==b(this).val()?m.show():m.hide()})},_search:function(a,
b){var c=JSON.stringify(d.retrieveCriteria(a));b.setGridParam({datatype:"json",postData:{criteria:c},page:1}).trigger("reloadGrid")}},c.init(a),d.popDialogCache[a.id]=c);return d.popDialogCache[a.id]};b.extend(b.wrender,{composite:{render:function(a){var e=b(a),f=b.wrender.getParam(a),l=d.defCache[f.compositeId];if(void 0==l)return alert('Failed to find the composite definition of "compositeId='+f.compositeId+'"!'),b(a);var k=c(l);e.append(d.getInnerHtml(l.popupLabel));b("button.wr_button",a).button();
b("button[name=popup]",a).click(function(){k.open(b.wrender.getValueProp(a),a)})},setValue:function(a,c){var f=d.toLabelString(c);b("span[name=valueLabel]",a).html(f)},getValue:function(a){return b.wrender.getValueProp(a)},getValueLabel:function(a){return d.toLabelString(this.getValue(a))},change:function(a,b){void 0==a.wrChange?a.wrChange=[b]:a.wrChange.push(b)},getHtml:function(a,b){return html='<div wrType="composite" '+(null!=b?'wrParam="'+b+'"':"")+'name="'+a+'"></div>'}},addComposite:function(a){d.defCache[a.id]=
a}})})(jQuery);(function(b){b.datepk.setDefaults(b.extend({regional:"zh-CN",showMonthAfterYear:!1,changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showOn:"button",showButtonPanel:!0,buttonImage:b.wrender.context+"/jslib/wrender/images/calendar.gif",buttonImageOnly:!0}));b.extend(b.wrender,{date:{render:function(d){b(d).datepk()},setValue:function(d,c){b(d).val(b.wrender.filterOutNull(c))},getValue:function(d){return b(d).val()},getValueLabel:function(b){return this.getValue(b)},show:function(d){b(d).next("img.ui-datepicker-trigger").show();
b(d).show()},hide:function(d){b(d).next("img.ui-datepicker-trigger").hide();b(d).hide()},change:function(d,c){b(d).change(b.wrender.wrapChange(d,c))},getHtml:function(b,c){return html='<input type="text" wrType="date" '+(null!=c?'wrParam="'+c+'"':"")+'name="'+b+'"/>'}}})})(jQuery);(function(b){b.datepicker.setDefaults(b.extend({regional:"zh-CN",showMonthAfterYear:!1,changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showOn:"button",showButtonPanel:!0,buttonImage:b.wrender.context+"/jslib/wrender/images/calendar.gif",buttonImageOnly:!0}));var d={showSecond:!0,timeFormat:"HH:mm:ss",timeText:"\u65f6\u95f4\uff1a",hourText:"\u65f6\uff1a",minuteText:"\u5206\uff1a",secondText:"\u79d2\uff1a",currentText:"\u5f53\u524d\u65f6\u95f4",closeText:"\u786e\u5b9a"};b.extend(b.wrender,{datetime:{render:function(c){b(c).datetimepicker(d)},
setValue:function(c,a){b(c).val(b.wrender.filterOutNull(a))},getValue:function(c){return b(c).val()},getValueLabel:function(b){return this.getValue(b)},show:function(c){b(c).next("img.ui-datepicker-trigger").show();b(c).show()},hide:function(c){b(c).next("img.ui-datepicker-trigger").hide();b(c).hide()},change:function(c,a){b(c).change(b.wrender.wrapChange(c,a))},getHtml:function(b,a){return html='<input type="text" wrType="datetime" '+(null!=a?'wrParam="'+a+'"':"")+'name="'+b+'"/>'}}})})(jQuery);(function(b){var d={codeListUrl:b.wrender.context+"/segment/CodeListAction/getCodeList.do",cache:{},multiOptions:{selectedList:50,minWidth:270,selectedText:"\u5df2\u9009\u62e9#\u9879",noneSelectedText:"\u8bf7\u9009\u62e9..."},multiFilterOptions:{label:"\u8fc7\u6ee4",width:60,placeholder:"\u8f93\u5165\u5173\u952e\u5b57"},renderOptions:function(c,a){var e="";b.each(a,function(){e+='<option value="'+this.code+'">'+this.name+"</option>"});c.append(e)},render:function(c,a){var e=b(c);if(null!=a&&null!=
a.sourceId&&null!=a.typeId){var f=d.cache[a.sourceId+"_"+a.typeId];null!=f?d.renderOptions(e,f):b.ajax({async:!1,type:"GET",dataType:"json",url:d.codeListUrl+"?sourceId="+a.sourceId+"&typeId="+a.typeId,success:function(b){null!=b&&(d.renderOptions(e,b),d.cache[a.sourceId+"_"+a.typeId]=b)}})}}};b.extend(b.wrender,{select:{render:function(c){var a=b.wrender.getParam(c);d.render(c,a)},setValue:function(b,a){for(var e=0;e<b.options.length;e++)b.options[e].selected=b.options[e].value==a},getValue:function(c){return b(c).val()},
getValueLabel:function(c){return b(c).find(":selected").text()},change:function(c,a){b(c).change(b.wrender.wrapChange(c,a))},getHtml:function(b,a){return html='<select wrType="select" '+(null!=a?'wrParam="'+a+'"':"")+'name="'+b+'"></select>'}},multiselect:{render:function(c){var a=b(c),e=b.wrender.getParam(c);d.render(c,e);a.multiselect(d.multiOptions);null!=e&&"true"==e.filter&&a.multiselectfilter(d.multiFilterOptions)},setValue:function(c,a){var e=b(c);e.multiselect("uncheckAll");for(var d in a)e.find('[value="'+
a[d]+'"]').attr("selected",!0);e.multiselect("refresh")},getValue:function(c){var a=[];c=b(c).multiselect("getChecked");if(0<c.length)for(var e=0;e<c.length;e++)a.push(c[e].value);return a},getValueLabel:function(c){var a=this.getValue(c),e="";c=b.wrender.getParam(c);c=d.cache[c.sourceId+"_"+c.typeId];if(null!=c){var f={};b.each(c,function(a,b){f[b.code]=b.name});var l=!0;b.each(a,function(a,b){null!=f[b]&&(!1==l&&(e+=";"),e+=f[b],l=!1)})}return e},show:function(c){b(c).next("button.ui-multiselect").show()},
hide:function(c){b(c).next("button.ui-multiselect").hide()},change:function(c,a){b(c).change(b.wrender.wrapChange(c,a))},getHtml:function(b,a){return html='<select wrType="multiselect" multiple="multiple" style="display:none;" '+(null!=a?'wrParam="'+a+'"':"")+'name="'+b+'"></select>'}}})})(jQuery);(function(b){var d={defCache:{},popDialogCache:{},getInnerHtml:function(a){return'<span name="valueLabel"></span><button name="popup" class="wr_button" type="button">'+a+"</button>"},getPopDialogHtml:function(a){return'<div id="tree_'+a+'"><ul id="tree_ul_'+a+'" class="ztree"></ul></div>'},toLabelString:function(a,b){var c="";if(null!=b)for(var l=d.popDialogCache[a].tree,k=!0,h=0;h<b.length;h++){var g=b[h],m=l.getNodesByParam("id",g,null);null!=m&&1==m.length?(!1==k&&(c+="; "),c+=m[0].name,k=!1):
alert("Failed to find the tree node id="+g+",treeId="+a+", which was existed in value.")}return c}},c=function(a){var c=d.popDialogCache[a.id];null==c&&(c={def:null,dialog:null,grid:null,elem:null,init:function(a){a=this.def=a;var c="#tree_"+a.id,e=this;0==b(c).size()&&(b("body").append(d.getPopDialogHtml(a.id)),b(c).dialog({title:a.title,bgiframe:!0,autoOpen:!1,width:a.width,height:a.height,resizable:!1,modal:!0,buttons:{"\u9009\u5b9a":function(){e._applyValue.apply(e);b(this).dialog("close")},"\u53d6\u6d88":function(){b(this).dialog("close")}},
close:function(){}}),this.dialog=b(c),this.tree=b.fn.zTree.init(b("#tree_ul_"+a.id),{async:{enable:!0,async:!1,url:a.url,autoParam:["id"]},check:{enable:!0},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pid",rootPId:null}}}),b(c+" button.wr_button").button());this.tree=b.fn.zTree.getZTreeObj("tree_ul_"+a.id);this.dialog=b(c)},open:function(a,b){this.tree.checkAllNodes(!1);this.elem=b;if(null!=a&&0<a.length)for(var c=0;c<a.length;c++){var e=a[c],d=this.tree.getNodesByParam("id",e,null);null!=d&&1==
d.length?this.tree.checkNode(d[0]):alert("Failed to find the tree node id="+e+", treeId="+treeId+",  which was existed in value.")}return this.dialog.dialog("open")},_applyValue:function(){for(var a=[],c=this.tree.getCheckedNodes(!0),e=0;e<c.length;e++){var h=c[e];this.def.leafValueOnly?!1==h.isParent&&a.push(h.id):a.push(h.id)}b.wrender.setValueProp(this.elem,a);c=b.wrender.getParam(this.elem).treeId;c=d.toLabelString(c,a);b("span[name=valueLabel]",this.elem).html(c);if(void 0!=this.elem.wrChange)for(c=
this.elem,e=c.wrChange.length,h=0;h<e;h++){var g=c.wrChange[h];0==g.length?g.apply(c):g.apply(c,[a])}}},c.init(a),d.popDialogCache[a.id]=c);return d.popDialogCache[a.id]};b.extend(b.wrender,{tree:{render:function(a){var e=b(a),f=b.wrender.getParam(a),l=d.defCache[f.treeId];if(void 0==l)return alert('Failed to find the tree definition of "treeId='+f.treeId+'"!'),b(a);var k=c(l);e.append(d.getInnerHtml(l.popupLabel));b("button.wr_button",a).button();b("button[name=popup]",a).click(function(){k.open(b.wrender.getValueProp(a),
a)})},setValue:function(a,c){b("span[name=valueLabel]",a).html(this.getValueLabel(a,c))},getValue:function(a){return b.wrender.getValueProp(a)},getValueLabel:function(a){var c=this.getValue(a);a=b.wrender.getParam(a).treeId;return d.toLabelString(a,c)},change:function(a,b){void 0==a.wrChange?a.wrChange=[b]:a.wrChange.push(b)},getHtml:function(a,b){return html='<div wrType="tree" '+(null!=b?'wrParam="'+b+'"':"")+'name="'+a+'"></div>'}},addTree:function(a){d.defCache[a.id]=a}})})(jQuery);
